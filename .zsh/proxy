# Proxy traffic through ssh
networkservices() {
    networksetup -listallnetworkservices | grep -v 'Bluetooth\|iPhone\|FireWire\|\*'
}

proxy() {
    port=1456
    networkservices | while read service; do
        sudo networksetup -setsocksfirewallproxy "$service" "127.0.0.1" $port
        sudo networksetup -setsocksfirewallproxystate "$service" on
    done
    ssh -fND $port ocean
    echo "$fg[green]Proxy enabled$reset_color"
}

torproxy() {
    port=9050
    networkservices | while read service; do
        sudo networksetup -setsocksfirewallproxy "$service" "127.0.0.1" $port
        sudo networksetup -setsocksfirewallproxystate "$service" on
    done
    nohup tor 2>&1 >/dev/null &
}

unproxy() {
    networkservices | while read service; do
        sudo networksetup -setsocksfirewallproxystate "$service" off
    done
    ps aux | grep 'ssh -fND\|\btor\b' | grep -v grep | awk '{print $2}' | xargs kill -9
    echo "$fg[yellow]Proxy disabled$reset_color"
}
