#!/bin/bash

is_git_dir() {
  [ -d "$1" ] && [ -d "$1/.git" ]
}

list_repos() {
  ls -1 "$1" | while read REPO_NAME; do
    REPO_DIR="$1/$REPO_NAME"
    is_git_dir "$REPO_DIR" && echo $REPO_DIR
  done
}

list_repos "$(pwd)" | while read REPO_DIR; do
  echo $REPO_DIR
  GIT_DIR="$REPO_DIR/.git" GIT_WORK_TREE="$REPO_DIR" git $@
  echo
done
